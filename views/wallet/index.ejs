<!-- views/wallet/index.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head', { title: title }) %>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="dashboard-body">
    <div class="dashboard-wrapper">
        <%- include('../partials/sidebar', { user: currentUser, active: 'wallet' }) %>
        <main class="dashboard-main-content">
            <div class="page-header glass-effect">
                <h1><i class="fas fa-wallet icon"></i> Dompet & Keuangan</h1>
                <p>Kelola saldo, isi dana, dan tarik penghasilan Anda di sini.</p>
            </div>

            <% if (locals.error) { %>
                <div class="alert alert-danger"><%= locals.error %></div>
            <% } %>
            <% if (locals.success) { %>
                <div class="alert alert-success"><%= locals.success %></div>
            <% } %>

            <div class="wallet-grid">
                <div class="card glass-effect balance-card">
                    <h3>Saldo Tersedia</h3>
                    <p class="balance-amount">Rp <%= user.balance.toLocaleString('id-ID') %></p>
                    <div class="balance-actions">
                         <a href="#deposit-section" class="btn btn-primary">Isi Saldo</a>
                         <% if (user.role === 'freelancer') { %>
                            <a href="#withdraw-section" class="btn btn-secondary">Tarik Saldo</a>
                         <% } %>
                    </div>
                </div>

                <div class="card glass-effect" id="deposit-section">
                    <h3><i class="fas fa-arrow-down icon"></i> Isi Saldo (Deposit)</h3>
                    <p class="section-description">Isi saldo Anda dengan aman melalui payment gateway kami. Saldo akan otomatis ditambahkan setelah pembayaran berhasil.</p>
                    <form action="/wallet/deposit" method="POST">
                        <div class="form-group">
                            <label for="amount">Jumlah (IDR)</label>
                            <input type="number" id="amount" name="amount" placeholder="Minimal 3.000" min="3000" required>
                        </div>
                        <button type="submit" class="btn btn-primary full-width">Lanjutkan ke Pembayaran</button>
                    </form>
                </div>

                <% if (user.role === 'freelancer') { %>
                <div class="card glass-effect" id="withdraw-section">
                    <h3><i class="fas fa-arrow-up icon"></i> Tarik Saldo (Withdraw)</h3>
                     <p class="section-description">Permintaan penarikan akan diproses dalam 1-2 hari kerja.</p>
                    <form action="/wallet/withdraw" method="POST">
                        <div class="form-group">
                            <label for="withdrawAmount">Jumlah Penarikan (IDR)</label>
                            <input type="number" id="withdrawAmount" name="amount" placeholder="Minimal 15.000" min="15000" required>
                        </div>
                        <div class="form-group">
                            <label for="bank">Nama Bank</label>
                            <input type="text" id="bank" name="bank" placeholder="Contoh: BCA, Mandiri, BNI" required>
                        </div>
                        <div class="form-group">
                            <label for="accountNumber">Nomor Rekening</label>
                            <input type="text" id="accountNumber" name="accountNumber" required>
                        </div>
                        <button type="submit" class="btn btn-secondary full-width">Ajukan Penarikan Dana</button>
                    </form>
                </div>
                <% } %>
            </div>

            <div class="card glass-effect transaction-history">
                <h3>Riwayat Transaksi Terbaru</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Tipe</th>
                            <th>Jumlah</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (transactions && transactions.length > 0) { %>
                            <% transactions.forEach(tx => { %>
                                <tr class="tx-<%= tx.type %>">
                                    <td><%= new Date(tx.createdAt).toLocaleDateString('id-ID') %></td>
                                    <td><%= tx.type.charAt(0).toUpperCase() + tx.type.slice(1) %></td>
                                    <td class="tx-amount <%= tx.amount > 0 ? 'positive' : 'negative' %>">
                                        Rp <%= tx.amount.toLocaleString('id-ID') %>
                                    </td>
                                    <td><span class="status-<%= tx.status %>"><%= tx.status %></span></td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="4">Tidak ada riwayat transaksi.</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</body>
</html>